<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greywater State Directory</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            color: #7f8c8d;
            max-width: 600px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card.fully-legal {
            border-left: 4px solid #27ae60;
        }

        .stat-card.restricted {
            border-left: 4px solid #f39c12;
        }

        .stat-card.limited {
            border-left: 4px solid #e67e22;
        }

        .stat-card.prohibited {
            border-left: 4px solid #e74c3c;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-card.fully-legal .stat-number {
            color: #27ae60;
        }

        .stat-card.restricted .stat-number {
            color: #f39c12;
        }

        .stat-card.limited .stat-number {
            color: #e67e22;
        }

        .stat-card.prohibited .stat-number {
            color: #e74c3c;
        }

        .stat-label {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-description {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .view-toggle {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .toggle-btn {
            padding: 12px 24px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .toggle-btn.active {
            background: #3498db;
            color: white;
        }

        .toggle-btn:hover {
            background: #2980b9;
            color: white;
            border-color: #2980b9;
        }

        .states-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .state-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .state-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .state-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .state-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e50;
            flex: 1;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-fully-legal {
            background: #d5f4e6;
            color: #27ae60;
            border: 1px solid #27ae60;
        }

        .status-restricted {
            background: #fef9e7;
            color: #f39c12;
            border: 1px solid #f39c12;
        }

        .status-limited {
            background: #fdf2e9;
            color: #e67e22;
            border: 1px solid #e67e22;
        }

        .status-prohibited {
            background: #fdedec;
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }

        .state-description {
            color: #7f8c8d;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }

        .state-details {
            font-size: 0.9rem;
            color: #5a6c7d;
            line-height: 1.5;
        }

        .states-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }

        .states-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .states-table th {
            background: #34495e;
            color: white;
            padding: 20px;
            text-align: left;
            font-weight: 600;
        }

        .states-table td {
            padding: 20px;
            border-bottom: 1px solid #ecf0f1;
        }

        .states-table tr:hover {
            background: #f8f9fa;
        }

        .hidden {
            display: none;
        }

        .legal-notice {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 12px;
            padding: 25px;
            margin-top: 40px;
        }

        .legal-notice h3 {
            color: #1976d2;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legal-notice p {
            color: #1565c0;
            line-height: 1.6;
        }

        .icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .states-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .states-table {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Greywater State Laws & Regulations</h1>
            <p>Understanding the legal landscape for greywater systems across the United States</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card fully-legal">
                <div class="stat-number" id="fully-legal-count">0</div>
                <div class="stat-label">Fully Legal</div>
                <div class="stat-description">Comprehensive regulations allowing greywater systems with permits</div>
            </div>
            <div class="stat-card restricted">
                <div class="stat-number" id="restricted-count">0</div>
                <div class="stat-label">Restricted</div>
                <div class="stat-description">Limited use, often only specific system types allowed</div>
            </div>
            <div class="stat-card limited">
                <div class="stat-number" id="limited-count">0</div>
                <div class="stat-label">Limited</div>
                <div class="stat-description">Unclear regulations or case-by-case approval</div>
            </div>
            <div class="stat-card prohibited">
                <div class="stat-number" id="prohibited-count">0</div>
                <div class="stat-label">Prohibited</div>
                <div class="stat-description">No greywater systems permitted or no formal regulations</div>
            </div>
        </div>

        <div class="view-toggle">
            <button class="toggle-btn active" onclick="showCardView()">Card View</button>
            <button class="toggle-btn" onclick="showTableView()">Table View</button>
        </div>

        <div id="card-view" class="states-grid"></div>
        
        <div id="table-view" class="states-table hidden">
            <table>
                <thead>
                    <tr>
                        <th>State</th>
                        <th>Status</th>
                        <th>Permit Required</th>
                        <th>Indoor Use</th>
                        <th>Outdoor Use</th>
                        <th>Key Restrictions</th>
                    </tr>
                </thead>
                <tbody id="table-body"></tbody>
            </table>
        </div>

        <div class="legal-notice">
            <h3>
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                </svg>
                Important Legal Notice
            </h3>
            <p>This information is for general guidance only and may not reflect the most current regulations. Greywater laws vary significantly by state, county, and municipality. Always consult with local authorities and obtain necessary permits before installing any greywater system.</p>
        </div>
    </div>

    <script>
        // State data would be loaded from your JSON file
        let stateData = [];

        // Load state data
        async function loadStateData() {
            try {
                const response = await fetch('./greywater-state-directory.json');
                const data = await response.json();
                stateData = Object.entries(data.states).map(([stateName, info]) => ({
                    state: stateName,
                    ...info,
                    status: getStatusCategory(info.legalStatus)
                })).sort((a, b) => a.state.localeCompare(b.state));
                
                updateStats();
                renderCardView();
                renderTableView();
            } catch (error) {
                console.error('Error loading state data:', error);
            }
        }

        function getStatusCategory(legalStatus) {
            if (legalStatus === "Legal" || legalStatus === "Legal and Regulated" || legalStatus === "Regulated and Permitted" || legalStatus === "Comprehensive Regulations") {
                return "Fully Legal";
            } else if (legalStatus === "Restricted" || legalStatus === "Highly Restricted" || legalStatus === "Limited" || legalStatus === "Limited/Unclear") {
                return "Restricted";
            } else if (legalStatus === "Effectively Prohibited" || legalStatus === "No Formal Regulations" || legalStatus === "No Specific Regulations") {
                return "Prohibited";
            }
            return "Limited";
        }

        function updateStats() {
            const counts = {
                'Fully Legal': 0,
                'Restricted': 0,
                'Limited': 0,
                'Prohibited': 0
            };

            stateData.forEach(state => {
                counts[state.status]++;
            });

            document.getElementById('fully-legal-count').textContent = counts['Fully Legal'];
            document.getElementById('restricted-count').textContent = counts['Restricted'];
            document.getElementById('limited-count').textContent = counts['Limited'];
            document.getElementById('prohibited-count').textContent = counts['Prohibited'];
        }

        function getStatusClass(status) {
            return status.toLowerCase().replace(/\s+/g, '-');
        }

        function renderCardView() {
            const cardView = document.getElementById('card-view');
            cardView.innerHTML = stateData.map(state => `
                <div class="state-card" onclick="showStateDetails('${state.state}')">
                    <div class="state-header">
                        <div class="state-name">${state.state}</div>
                        <div class="status-badge status-${getStatusClass(state.status)}">${state.status}</div>
                    </div>
                    <div class="state-description">${state.regulatoryClassification}</div>
                    <div class="state-details">
                        ${state.keyRestrictions.slice(0, 2).join('. ')} ${state.keyRestrictions.length > 2 ? '...' : ''}
                    </div>
                </div>
            `).join('');
        }

        function renderTableView() {
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = stateData.map(state => `
                <tr onclick="showStateDetails('${state.state}')">
                    <td><strong>${state.state}</strong></td>
                    <td><span class="status-badge status-${getStatusClass(state.status)}">${state.status}</span></td>
                    <td>${state.permitRequired}</td>
                    <td>${state.indoorUseAllowed ? '✓' : '✗'}</td>
                    <td>${state.outdoorUseAllowed ? '✓' : '✗'}</td>
                    <td>${state.keyRestrictions.slice(0, 2).join('. ')}</td>
                </tr>
            `).join('');
        }

        function showCardView() {
            document.getElementById('card-view').classList.remove('hidden');
            document.getElementById('table-view').classList.add('hidden');
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showTableView() {
            document.getElementById('card-view').classList.add('hidden');
            document.getElementById('table-view').classList.remove('hidden');
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showStateDetails(stateName) {
            // For Shopify App Proxy, you might want to redirect to a detail page
            // or show a modal with more information
            const state = stateData.find(s => s.state === stateName);
            if (state) {
                alert(`${stateName}\n\nStatus: ${state.status}\nAgency: ${state.primaryAgency}\nSummary: ${state.summary.substring(0, 200)}...`);
            }
        }

        // Initialize the app
        loadStateData();
    </script>
</body>
</html>